'use strict';

;(function ($, window, document) {

  //defaults value
  var defaults = {
    'width': 1024,
    'next': '<span class="arrow">&rsaquo;</span>',
    'prev': '<span class="back-arrow">&lsaquo;</span>',
    'linkSwitch': false,
    'showParent': true,
    'backButtonText': 'Назад'
  };

  function MultiMenu(element, options) {
    //vars block
    this.options = $.extend({}, defaults, options);
    this.element = element;
    this.init();
  }

  //call init function
  MultiMenu.prototype.init = function () {

    var self = this,
        element = this.element,
        attrId = element.attr('id'),
        attrClass = element.attr('class'),
        menuClass = 'close-list active-menu hidden-menu',
        menuEnabled = false;

    //create animate-menu function
    function openMenu() {
      $('body').toggleClass('bodyFixed');
      setTimeout(function () {
        $('.multilevelMenu ul').attr('class', '');
      }, 400);
    }

    //swipe function for open menu
    function SwipeOpenMenu() {
      //create swipe-selector
      if ($('.multilevelMenu').length > 0) {
        $('body').append('<span class="js-swipe"></span>');
        var touchstartX = 0,
            touchendX = 0;
        // open menu on tap swipe
        $('.js-swipe, .multilevelMenu').on('touchstart', function (e) {
          touchstartX = e.originalEvent.changedTouches[0].pageX;
        });

        $('.js-swipe').on('touchend', function (e) {
          touchendX = e.originalEvent.changedTouches[0].pageX;
          if (touchendX > touchstartX) {
            //call animate-menu function
            openMenu();
          }
        });

        //close menu left-swipe
        $('.multilevelMenu').on('touchend', function (e) {
          touchendX = e.originalEvent.changedTouches[0].pageX;
          if (touchendX < touchstartX - 20) {
            $('body').removeClass('bodyFixed');
            setTimeout(function () {
              $('.multilevelMenu ul').attr('class', '');
            }, 400);
          }
        });
      } else {
        return false;
      }
    }

    //create work-menu function
    function mobileMenu() {

      var w = window.innerWidth ? window.innerWidth : $(window).width();

      //next level function
      function nextLevelFunction(e, el) {
        e.preventDefault();
        e.stopPropagation();
        el.parents('ul').addClass('close-list');
        el.closest('li').children('ul').addClass('active-menu');
      }

      //add text for prev button function
      function textPrevButton(str, el) {
        if (str.length > 0) {
          str = str.substring(0, str.length - 1);
        }
        el.closest('li').find('li.back').text(str);
        $('.js-back').append(self.options.prev);
      }

      if (w < self.options.width) {
        //remove attr
        if (!menuEnabled) {
          menuEnabled = true;
          element.removeAttr('id');
          element.removeClass();
          element.find('> ul').removeClass();
          element.addClass('multilevelMenu');
          //call swipe function
          SwipeOpenMenu();
          //add switch-button for children ul
          var link = element.find('a');
          link.append(function (indx, val) {
            var out = '';
            if ($(this).parent('li').find('ul').length > 0) {
              out = self.options.next;
            }
            return $(out).addClass('js-arrow');
          });
          //add back-button function
          element.find('li').find('ul').prepend('<li class="back js-back"></li>');

          //view next level menu full button
          if (self.options.linkSwitch == true) {

            $(link).on("click", function (e) {
              if ($(this).next('ul').length > 0) {
                nextLevelFunction(e, $(this));
              }
              //name prev-button text
              var str = $(this).text();
              textPrevButton(str, $(this));
            });
          } else {

            //view next level menu on only arrow
            $(link).on("click", ".js-arrow", function (e) {
              nextLevelFunction(e, $(this));
              //name prev-button text
              var str = $(this).parents('a').text();
              textPrevButton(str, $(this));
            });
          }

          //view prev level menu to click "back"
          $('.js-back').click(function () {
            $(this).closest('ul.close-list').removeClass('close-list');
            $(this).closest('ul').addClass('hidden-menu');
            var that = this;
            setTimeout(function () {
              $(that).closest('ul').removeClass('active-menu hidden-menu');
            }, 400);
          });
        }
      } else {
        if (menuEnabled) {
          //return attr
          menuEnabled = false;
          element.attr('id', attrId);
          element.attr('class', attrClass);
          $('.js-arrow, .js-back, .js-swipe').detach();
        }

        $('body').removeClass('bodyFixed'); //remove fixedClass to body
        element.find('ul').removeClass(menuClass);
        element.find('> ul').addClass('menu flex jcsb');
      }
    }

    //call work-menu function
    mobileMenu();

    //remove attr resize
    $(window).resize(function () {
      //call work-menu function
      mobileMenu();
    });

    //animate menu function Call
    $('.js-toggle').add($('.js-overlay')).on("click", function () {
      //call animate-menu function
      openMenu();
      $('.js-swipe').toggleClass('none');
    });
  };

  $.fn.mobileMenu = function (options) {
    new MultiMenu(this.first(), options);
    return this.first();
  };
})(jQuery, window, document);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vYmlsZU1lbnUuanMiXSwibmFtZXMiOlsiJCIsIndpbmRvdyIsImRvY3VtZW50IiwiZGVmYXVsdHMiLCJNdWx0aU1lbnUiLCJlbGVtZW50Iiwib3B0aW9ucyIsImV4dGVuZCIsImluaXQiLCJwcm90b3R5cGUiLCJzZWxmIiwiYXR0cklkIiwiYXR0ciIsImF0dHJDbGFzcyIsIm1lbnVDbGFzcyIsIm1lbnVFbmFibGVkIiwib3Blbk1lbnUiLCJ0b2dnbGVDbGFzcyIsInNldFRpbWVvdXQiLCJTd2lwZU9wZW5NZW51IiwibGVuZ3RoIiwiYXBwZW5kIiwidG91Y2hzdGFydFgiLCJ0b3VjaGVuZFgiLCJvbiIsImUiLCJvcmlnaW5hbEV2ZW50IiwiY2hhbmdlZFRvdWNoZXMiLCJwYWdlWCIsInJlbW92ZUNsYXNzIiwibW9iaWxlTWVudSIsInciLCJpbm5lcldpZHRoIiwid2lkdGgiLCJuZXh0TGV2ZWxGdW5jdGlvbiIsImVsIiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCJwYXJlbnRzIiwiYWRkQ2xhc3MiLCJjbG9zZXN0IiwiY2hpbGRyZW4iLCJ0ZXh0UHJldkJ1dHRvbiIsInN0ciIsInN1YnN0cmluZyIsImZpbmQiLCJ0ZXh0IiwicHJldiIsInJlbW92ZUF0dHIiLCJsaW5rIiwiaW5keCIsInZhbCIsIm91dCIsInBhcmVudCIsIm5leHQiLCJwcmVwZW5kIiwibGlua1N3aXRjaCIsImNsaWNrIiwidGhhdCIsImRldGFjaCIsInJlc2l6ZSIsImFkZCIsImZuIiwiZmlyc3QiLCJqUXVlcnkiXSwibWFwcGluZ3MiOiI7O0FBQUEsQ0FBRSxDQUFDLFVBQVVBLENBQVYsRUFBYUMsTUFBYixFQUFxQkMsUUFBckIsRUFBK0I7O0FBRWhDO0FBQ0EsTUFBSUMsV0FBVztBQUNiLGFBQVUsSUFERztBQUViLFlBQVMscUNBRkk7QUFHYixZQUFTLDBDQUhJO0FBSWIsa0JBQWUsS0FKRjtBQUtiLGtCQUFjLElBTEQ7QUFNYixzQkFBa0I7QUFOTCxHQUFmOztB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LE1BL0xULEVBK0xpQkMsUUEvTGpCIiwiZmlsZSI6Im1vYmlsZU1lbnUuanMiLCJzb3VyY2VzQ29udGVudCI6WyI7IChmdW5jdGlvbiAoJCwgd2luZG93LCBkb2N1bWVudCkge1xuXG4gIC8vZGVmYXVsdHMgdmFsdWVcbiAgdmFyIGRlZmF1bHRzID0ge1xuICAgICd3aWR0aCcgOiAxMDI0LFxuICAgICduZXh0JyA6ICc8c3BhbiBjbGFzcz1cImFycm93XCI+JnJzYXF1bzs8L3NwYW4+JyxcbiAgICAncHJldicgOiAnPHNwYW4gY2xhc3M9XCJiYWNrLWFycm93XCI+JmxzYXF1bzs8L3NwYW4+JyxcbiAgICAnbGlua1N3aXRjaCcgOiBmYWxzZSxcbiAgICAnc2hvd1BhcmVudCc6IHRydWUsXG4gICAgJ2JhY2tCdXR0b25UZXh0JzogJ9Cd0LDQt9Cw0LQnXG4gIH07XG5cbiAgZnVuY3Rpb24gTXVsdGlNZW51IChlbGVtZW50LCBvcHRpb25zKSB7XG4gICAgLy92YXJzIGJsb2NrXG4gICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIGRlZmF1bHRzLCBvcHRpb25zKTtcbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMuaW5pdCgpO1xuICB9XG5cbiAgLy9jYWxsIGluaXQgZnVuY3Rpb25cbiAgTXVsdGlNZW51LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgICBlbGVtZW50ID0gdGhpcy5lbGVtZW50LFxuICAgICAgICAgIGF0dHJJZCA9IGVsZW1lbnQuYXR0cignaWQnKSxcbiAgICAgICAgICBhdHRyQ2xhc3MgPSBlbGVtZW50LmF0dHIoJ2NsYXNzJyksXG4gICAgICAgICAgbWVudUNsYXNzID0gJ2Nsb3NlLWxpc3QgYWN0aXZlLW1lbnUgaGlkZGVuLW1lbnUnLFxuICAgICAgICAgIG1lbnVFbmFibGVkID0gZmFsc2U7XG5cbiAgICAgICAgLy9jcmVhdGUgYW5pbWF0ZS1tZW51IGZ1bmN0aW9uXG4gICAgICAgIGZ1bmN0aW9uIG9wZW5NZW51KCkge1xuICAgICAgICAgICQoJ2JvZHknKS50b2dnbGVDbGFzcygnYm9keUZpeGVkJyk7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQoJy5tdWx0aWxldmVsTWVudSB1bCcpLmF0dHIoJ2NsYXNzJywgJycpO1xuICAgICAgICAgIH0sIDQwMCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL3N3aXBlIGZ1bmN0aW9uIGZvciBvcGVuIG1lbnVcbiAgICAgICAgZnVuY3Rpb24gU3dpcGVPcGVuTWVudSgpIHtcbiAgICAgICAgICAvL2NyZWF0ZSBzd2lwZS1zZWxlY3RvclxuICAgICAgICAgIGlmICgkKCcubXVsdGlsZXZlbE1lbnUnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAkKCdib2R5JykuYXBwZW5kKCc8c3BhbiBjbGFzcz1cImpzLXN3aXBlXCI+PC9zcGFuPicpO1xuICAgICAgICAgICAgdmFyIHRvdWNoc3RhcnRYID0gMCxcbiAgICAgICAgICAgICAgICB0b3VjaGVuZFggPSAwO1xuICAgICAgICAgICAgLy8gb3BlbiBtZW51IG9uIHRhcCBzd2lwZVxuICAgICAgICAgICAgJCgnLmpzLXN3aXBlLCAubXVsdGlsZXZlbE1lbnUnKS5vbigndG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgdG91Y2hzdGFydFggPSBlLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVg7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJCgnLmpzLXN3aXBlJykub24oJ3RvdWNoZW5kJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgdG91Y2hlbmRYID0gZS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYO1xuICAgICAgICAgICAgICBpZiAodG91Y2hlbmRYID4gdG91Y2hzdGFydFgpIHtcbiAgICAgICAgICAgICAgICAvL2NhbGwgYW5pbWF0ZS1tZW51IGZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgb3Blbk1lbnUoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vY2xvc2UgbWVudSBsZWZ0LXN3aXBlXG4gICAgICAgICAgICAkKCcubXVsdGlsZXZlbE1lbnUnKS5vbigndG91Y2hlbmQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICB0b3VjaGVuZFggPSBlLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVg7XG4gICAgICAgICAgICAgIGlmICh0b3VjaGVuZFggPCAodG91Y2hzdGFydFggLSAyMCkpIHtcbiAgICAgICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ2JvZHlGaXhlZCcpO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgJCgnLm11bHRpbGV2ZWxNZW51IHVsJykuYXR0cignY2xhc3MnLCAnJyk7XG4gICAgICAgICAgICAgICAgfSwgNDAwKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy9jcmVhdGUgd29yay1tZW51IGZ1bmN0aW9uXG4gICAgICAgIGZ1bmN0aW9uIG1vYmlsZU1lbnUoKSB7XG5cbiAgICAgICAgICB2YXIgdyA9IHdpbmRvdy5pbm5lcldpZHRoID8gd2luZG93LmlubmVyV2lkdGggOiAkKHdpbmRvdykud2lkdGgoKTtcblxuICAgICAgICAgIC8vbmV4dCBsZXZlbCBmdW5jdGlvblxuICAgICAgICAgIGZ1bmN0aW9uIG5leHRMZXZlbEZ1bmN0aW9uIChlLCBlbCkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGVsLnBhcmVudHMoJ3VsJykuYWRkQ2xhc3MoJ2Nsb3NlLWxpc3QnKTtcbiAgICAgICAgICAgIGVsLmNsb3Nlc3QoJ2xpJykuY2hpbGRyZW4oJ3VsJykuYWRkQ2xhc3MoJ2FjdGl2ZS1tZW51Jyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy9hZGQgdGV4dCBmb3IgcHJldiBidXR0b24gZnVuY3Rpb25cbiAgICAgICAgICBmdW5jdGlvbiB0ZXh0UHJldkJ1dHRvbiAoc3RyLCBlbCkge1xuICAgICAgICAgICAgaWYgKHN0ci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgc3RyLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWwuY2xvc2VzdCgnbGknKS5maW5kKCdsaS5iYWNrJykudGV4dChzdHIpO1xuICAgICAgICAgICAgJCgnLmpzLWJhY2snKS5hcHBlbmQoc2VsZi5vcHRpb25zLnByZXYpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICh3IDwgc2VsZi5vcHRpb25zLndpZHRoKSB7XG4gICAgICAgICAgICAvL3JlbW92ZSBhdHRyXG4gICAgICAgICAgICAgaWYgKCFtZW51RW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgbWVudUVuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVBdHRyKCdpZCcpO1xuICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcygpO1xuICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCc+IHVsJykucmVtb3ZlQ2xhc3MoKTtcbiAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ211bHRpbGV2ZWxNZW51Jyk7XG4gICAgICAgICAgICAgICAgICAvL2NhbGwgc3dpcGUgZnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgIFN3aXBlT3Blbk1lbnUoKTtcbiAgICAgICAgICAgICAgICAgIC8vYWRkIHN3aXRjaC1idXR0b24gZm9yIGNoaWxkcmVuIHVsXG4gICAgICAgICAgICAgICAgICB2YXIgbGluayA9IGVsZW1lbnQuZmluZCgnYScpO1xuICAgICAgICAgICAgICAgICAgbGluay5hcHBlbmQoZnVuY3Rpb24oaW5keCwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvdXQgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgaWYoJCh0aGlzKS5wYXJlbnQoJ2xpJykuZmluZCgndWwnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgb3V0ID0gc2VsZi5vcHRpb25zLm5leHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICQob3V0KS5hZGRDbGFzcygnanMtYXJyb3cnKTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgLy9hZGQgYmFjay1idXR0b24gZnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnbGknKS5maW5kKCd1bCcpLnByZXBlbmQoJzxsaSBjbGFzcz1cImJhY2sganMtYmFja1wiPjwvbGk+Jyk7XG5cbiAgICAgICAgICAgICAgICAgIC8vdmlldyBuZXh0IGxldmVsIG1lbnUgZnVsbCBidXR0b25cbiAgICAgICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMubGlua1N3aXRjaCA9PSB0cnVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgJChsaW5rKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykubmV4dCgndWwnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0TGV2ZWxGdW5jdGlvbiAoZSwgJCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIC8vbmFtZSBwcmV2LWJ1dHRvbiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIHN0ciA9ICQodGhpcykudGV4dCgpO1xuICAgICAgICAgICAgICAgICAgICAgIHRleHRQcmV2QnV0dG9uIChzdHIsICQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAvL3ZpZXcgbmV4dCBsZXZlbCBtZW51IG9uIG9ubHkgYXJyb3dcbiAgICAgICAgICAgICAgICAgICAgJChsaW5rKS5vbihcImNsaWNrXCIsIFwiLmpzLWFycm93XCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgbmV4dExldmVsRnVuY3Rpb24gKGUsICQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICAgIC8vbmFtZSBwcmV2LWJ1dHRvbiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIHN0ciA9ICQodGhpcykucGFyZW50cygnYScpLnRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICB0ZXh0UHJldkJ1dHRvbiAoc3RyLCAkKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgLy92aWV3IHByZXYgbGV2ZWwgbWVudSB0byBjbGljayBcImJhY2tcIlxuICAgICAgICAgICAgICAgICAgJCgnLmpzLWJhY2snKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgndWwuY2xvc2UtbGlzdCcpLnJlbW92ZUNsYXNzKCdjbG9zZS1saXN0Jyk7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgndWwnKS5hZGRDbGFzcygnaGlkZGVuLW1lbnUnKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAkKHRoYXQpLmNsb3Nlc3QoJ3VsJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZS1tZW51IGhpZGRlbi1tZW51Jyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDQwMCk7XG4gICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlICB7XG4gICAgICAgICAgICAgaWYgKG1lbnVFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gYXR0clxuICAgICAgICAgICAgICAgIG1lbnVFbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKCdpZCcsIGF0dHJJZCk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKCdjbGFzcycsIGF0dHJDbGFzcyk7XG4gICAgICAgICAgICAgICAgJCgnLmpzLWFycm93LCAuanMtYmFjaywgLmpzLXN3aXBlJykuZGV0YWNoKCk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ2JvZHlGaXhlZCcpOyAvL3JlbW92ZSBmaXhlZENsYXNzIHRvIGJvZHlcbiAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCd1bCcpLnJlbW92ZUNsYXNzKG1lbnVDbGFzcyk7XG4gICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnPiB1bCcpLmFkZENsYXNzKCdtZW51IGZsZXggamNzYicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9jYWxsIHdvcmstbWVudSBmdW5jdGlvblxuICAgICAgICBtb2JpbGVNZW51KCk7XG5cbiAgICAgICAgLy9yZW1vdmUgYXR0ciByZXNpemVcbiAgICAgICAgJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgLy9jYWxsIHdvcmstbWVudSBmdW5jdGlvblxuICAgICAgICAgIG1vYmlsZU1lbnUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9hbmltYXRlIG1lbnUgZnVuY3Rpb24gQ2FsbFxuICAgICAgICAkKCcuanMtdG9nZ2xlJykuYWRkKCQoJy5qcy1vdmVybGF5JykpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy9jYWxsIGFuaW1hdGUtbWVudSBmdW5jdGlvblxuICAgICAgICAgICAgb3Blbk1lbnUoKTtcbiAgICAgICAgICAgICQoJy5qcy1zd2lwZScpLnRvZ2dsZUNsYXNzKCdub25lJylcbiAgICAgICAgfSk7XG5cbiAgfTtcblxuICAkLmZuLm1vYmlsZU1lbnUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIG5ldyBNdWx0aU1lbnUodGhpcy5maXJzdCgpLCBvcHRpb25zKTtcbiAgICByZXR1cm4gdGhpcy5maXJzdCgpO1xuICB9O1xuXG59KShqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQpOyJdfQ==
