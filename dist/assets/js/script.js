'use strict';

;(function () {

  $('document').ready(function () {

    $(document).foundation();

    var w = window.innerWidth ? window.innerWidth : $(window).width(),
        smallWidth = 640,
        speed = 250;

    //Скрипты для десктопной версии
    function desktop() {
      if (w > 1023) {
        $('.menu > li > ul > li > ul > li').each(function () {
          if ($(this).find('ul').length > 0) {
            $(this).find('a').addClass('parent');
          }
        });
      }
    }
    desktop();

    //Скрипты для мобильной версии
    function mobile() {
      if (w < smallWidth) {
        $('.footer__menu--title').on('click', function () {
          $(this).toggleClass('active').next().slideToggle(speed);
        });
      }
    }
    mobile();

    //Мобильное меню
    $('.menu__wrapper').mobileMenu();

    //Слайдер
    $('.slider').slick({
      speed: 300,
      dots: false,
      responsive: [{
        breakpoint: 768,
        settings: {
          arrows: false,
          dots: true
        }
      }]
    });

    //Слайдер брендов
    $('.brandSlider__list').slick({
      dots: true,
      arrows: false,
      slidesToShow: 4,
      slidesToScroll: 1,
      responsive: [{
        breakpoint: 1023,
        settings: {
          slidesToShow: 3,
          slidesToScroll: 1
        }
      }, {
        breakpoint: 767,
        settings: {
          slidesToShow: 2
        }
      }, {
        breakpoint: 480,
        settings: {
          slidesToShow: 1
        }
      }]
    });

    $('#product__panel2, #product__panel1').slick({
      dots: false,
      slidesToShow: 4,
      slidesToScroll: 1,
      responsive: [{
        breakpoint: 1023,
        settings: {
          slidesToShow: 3,
          slidesToScroll: 1
        }
      }, {
        breakpoint: 767,
        settings: {
          slidesToShow: 2
        }
      }, {
        breakpoint: 480,
        settings: {
          slidesToShow: 1
        }
      }]
    });

    //touch-events for slider
    $('.ui-slider-handle ').draggable();

    //Инициализация слайдера
    function uiSlider() {
      jQuery("#slider").slider({
        min: 0,
        max: 1000,
        values: [0, 1000],
        range: true,
        stop: function stop(event, ui) {
          jQuery("input#minCost").val(jQuery("#slider").slider("values", 0));
          jQuery("input#maxCost").val(jQuery("#slider").slider("values", 1));
        },
        slide: function slide(event, ui) {
          jQuery("input#minCost").val(jQuery("#slider").slider("values", 0));
          jQuery("input#maxCost").val(jQuery("#slider").slider("values", 1));
        }
      });

      jQuery("input#minCost").change(function () {
        var value1 = jQuery("input#minCost").val();
        var value2 = jQuery("input#maxCost").val();
        if (parseInt(value1) > parseInt(value2)) {
          value1 = value2;
          jQuery("input#minCost").val(value1);
        }
        jQuery("#slider").slider("values", 0, value1);
      });

      jQuery("input#maxCost").change(function () {

        var value1 = jQuery("input#minCost").val();
        var value2 = jQuery("input#maxCost").val();

        if (parseInt(value1) > parseInt(value2)) {
          value2 = value1;
          jQuery("input#maxCost").val(value2);
        }
        jQuery("#slider").slider("values", 1, value2);
      });

      // фильтрация ввода в поля
      jQuery('input').keypress(function (event) {
        var key, keyChar;
        if (!event) var event = window.event;
        if (event.keyCode) key = event.keyCode;else if (event.which) key = event.which;
        if (key == null || key == 0 || key == 8 || key == 13 || key == 9 || key == 46 || key == 37 || key == 39) return true;
        keyChar = String.fromCharCode(key);
        if (!/\d/.test(keyChar)) return false;
      });
    };
    uiSlider();

    //Раскрытие второго уровня меню в сайдбаре
    $('.leftMenu > ul > li > a').on('click', 'span', function (e) {
      e.preventDefault();
      e.stopPropagation();
      $(this).toggleClass('active').closest('a').next('ul').slideToggle(speed);
    });

    //Раскрытие тела одной категории фильтра
    $('.filter__name').on('click', function () {
      $(this).toggleClass('no-active').next('.filter__body').slideToggle(speed);
    });

    //Скрываем часть фильтров при загрузке
    function filterItemHidden() {
      var count = 2;
      $('.filter').find(function () {
        if ($(this).find('.filter__item').length > count) {
          $(this).find('.filter__item').eq(count - 1).nextAll().find('.filter__name').addClass('no-active').next('.filter__body').css({ 'display': 'none' });
        }
      });
    };
    filterItemHidden

    //Разворачивание инпутов в фильтре
    ();function filterCompany() {
      var count = 3,
          selector = '<div class="company__wrap" />',
          switchSel = $('.filter__toggle'),
          switchSelText = switchSel.text(),
          switchSelNewText = '- Свернуть';
      $('.filter__company').find(function () {
        if ($(this).find('.filter__company--item').length > count) {
          $(this).find('.filter__company--item').eq(count - 1).nextAll().wrapAll(selector);
        }
      });
      switchSel.on('click', function () {
        $('.company__wrap').slideToggle(speed);
        if ($(this).text() == switchSelNewText) {
          $(this).text(switchSelText);
        } else {
          $(this).text(switchSelNewText);
        }
      });
    };

    filterCompany();

    $('.filter__switch').on('click', function () {
      $(this).next('.filter').slideToggle(speed);
    });

    $('.info__category--item').on('click', function () {
      $(this).closest('.info__category').find('.mainButtons').removeClass('mainButtons');
      $(this).addClass('mainButtons');
    });
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyIkIiwicmVhZHkiLCJkb2N1bWVudCIsImZvdW5kYXRpb24iLCJ3Iiwid2luZG93IiwiaW5uZXJXaWR0aCIsIndpZHRoIiwic21hbGxXaWR0aCIsInNwZWVkIiwiZGVza3RvcCIsImVhY2giLCJmaW5kIiwibGVuZ3RoIiwiYWRkQ2xhc3MiLCJtb2JpbGUiLCJvbiIsInRvZ2dsZUNsYXNzIiwibmV4dCIsInNsaWRlVG9nZ2xlIiwibW9iaWxlTWVudSIsInNsaWNrIiwiZG90cyIsInJlc3BvbnNpdmUiLCJicmVha3BvaW50Iiwic2V0dGluZ3MiLCJhcnJvd3MiLCJzbGlkZXNUb1Nob3ciLCJzbGlkZXNUb1Njcm9sbCIsImRyYWdnYWJsZSIsInVpU2xpZGVyIiwialF1ZXJ5Iiwic2xpZGVyIiwibWluIiwibWF4IiwidmFsdWVzIiwicmFuZ2UiLCJzdG9wIiwiZXZlbnQiLCJ1aSIsInZhbCIsInNsaWRlIiwiY2hhbmdlIiwidmFsdWUxIiwidmFsdWUyIiwicGFyc2VJbnQiLCJrZXlwcmVzcyIsImtleSIsImtleUNoYXIiLCJrZXlDb2RlIiwid2hpY2giLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJ0ZXN0IiwiZSIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwiY2xvc2VzdCIsImZpbHRlckl0ZW1IaWRkZW4iLCJjb3VudCIsImVxIiwibmV4dEFsbCIsImNzcyIsImZpbHRlckNvbXBhbnkiLCJzZWxlY3RvciIsInN3aXRjaFNlbCIsInN3aXRjaFNlbFRleHQiLCJ0ZXh0Iiwic3dpdGNoU2VsTmV3VGV4dCIsIndyYXBBbGwiLCJyZW1vdmVDbGFzcyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxDQUFFLGFBQVc7O0FBR1hBLElBQUUsVUFBRixFQUFjQyxLQUFkLENBQW9CLFlBQVc7O0FBRTdCRCxNQUFFRSxRQUFGLEVBQVlDLFVBQVo7O0FBRUEsUUFBSUMsSUFBSUMsT0FBT0MsVUFBUCxHQUFvQkQsT0FBT0MsVUFB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QUFDRDtBQUNGLE9BSkQ7QUFLQUMsZ0JBQVVqRCxFQUFWLENBQWEsT0FBYixFQUFzQixZQUFXO0FBQy9CaEIsVUFBRSxnQkFBRixFQUFvQm1CLFdBQXBCLENBQWdDVixLQUFoQztBQUNBLFlBQUdULEVBQUUsSUFBRixFQUFRbUUsSUFBUixNQUFrQkMsZ0JBQXJCLEVBQXVDO0FBQ3JDcEUsWUFBRSxJQUFGLEVBQVFtRSxJQUFSLENBQWFELGFBQWI7QUFDRCxTQUZELE1BRU87QUFDTGxFLFlBQUUsSUFBRixFQUFRbUUsSUFBUixDQUFhQyxnQkFBYjtBQUNEO0FBQ0YsT0FQRDtBQVFEOztBQUVETDs7QUFFQS9ELE1BQUUsaUJBQUYsRUFBcUJnQixFQUFyQixDQUF3QixPQUF4QixFQUFpQyxZQUFXO0FBQzFDaEIsUUFBRSxJQUFGLEVBQVFrQixJQUFSLENBQWEsU0FBYixFQUF3QkMsV0FBeEIsQ0FBb0NWLEtBQXBDO0FBQ0QsS0FGRDs7QUFJQVQsTUFBRSx1QkFBRixFQUEyQmdCLEVBQTNCLENBQThCLE9BQTlCLEVBQXVDLFlBQVc7QUFDaERoQixRQUFFLElBQUYsRUFBUXlELE9BQVIsQ0FBZ0IsaUJBQWhCLEVBQW1DN0MsSUFBbkMsQ0FBd0MsY0FBeEMsRUFBd0QwRCxXQUF4RCxDQUFvRSxhQUFwRTtBQUNBdEUsUUFBRSxJQUFGLEVBQVFjLFFBQVIsQ0FBaUIsYUFBakI7QUFDRCxLQUhEO0FBS0QsR0EzTkQ7QUE2TkQsQ0FoT0MsR0FBRCIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyI7KGZ1bmN0aW9uKCkge1xuXG5cbiAgJCgnZG9jdW1lbnQnKS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICBcbiAgICAkKGRvY3VtZW50KS5mb3VuZGF0aW9uKCk7XG5cbiAgICB2YXIgdyA9IHdpbmRvdy5pbm5lcldpZHRoID8gd2luZG93LmlubmVyV2lkdGggOiAkKHdpbmRvdykud2lkdGgoKSxcbiAgICAgICAgc21hbGxXaWR0aCA9IDY0MCxcbiAgICAgICAgc3BlZWQgPSAyNTA7XG5cblxuICAgIC8v0KHQutGA0LjQv9GC0Ysg0LTQu9GPINC00LXRgdC60YLQvtC/0L3QvtC5INCy0LXRgNGB0LjQuFxuICAgIGZ1bmN0aW9uIGRlc2t0b3AoKSB7XG4gICAgICBpZih3ID4gMTAyMykge1xuICAgICAgICAkKCcubWVudSA+IGxpID4gdWwgPiBsaSA+IHVsID4gbGknKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCQodGhpcykuZmluZCgndWwnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmZpbmQoJ2EnKS5hZGRDbGFzcygncGFyZW50Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgZGVza3RvcCgpOyBcblxuXG4gICAgLy/QodC60YDQuNC/0YLRiyDQtNC70Y8g0LzQvtCx0LjQu9GM0L3QvtC5INCy0LXRgNGB0LjQuFxuICAgIGZ1bmN0aW9uIG1vYmlsZSgpIHtcbiAgICAgIGlmKHcgPCBzbWFsbFdpZHRoKSB7XG4gICAgICAgICQoJy5mb290ZXJfX21lbnUtLXRpdGxlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKS5uZXh0KCkuc2xpZGVUb2dnbGUoc3BlZWQpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgbW9iaWxlKCk7XG5cbiAgICAvL9Cc0L7QsdC40LvRjNC90L7QtSDQvNC10L3RjlxuICAgICQoJy5tZW51X193cmFwcGVyJykubW9iaWxlTWVudSgpO1xuXG4gICAgLy/QodC70LDQudC00LXRgFxuICAgICQoJy5zbGlkZXInKS5zbGljayh7XG4gICAgICBzcGVlZDogMzAwLFxuICAgICAgZG90czogZmFsc2UsXG4gICAgICByZXNwb25zaXZlOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBicmVha3BvaW50OiA3NjgsXG4gICAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgIGFycm93czogZmFsc2UsXG4gICAgICAgICAgICBkb3RzOiB0cnVlXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSk7XG5cbiAgICAvL9Ch0LvQsNC50LTQtdGAINCx0YDQtdC90LTQvtCyXG4gICAgJCgnLmJyYW5kU2xpZGVyX19saXN0Jykuc2xpY2soe1xuICAgICAgZG90czogdHJ1ZSxcbiAgICAgIGFycm93czogZmFsc2UsXG4gICAgICBzbGlkZXNUb1Nob3c6IDQsXG4gICAgICBzbGlkZXNUb1Njcm9sbDogMSxcbiAgICAgIHJlc3BvbnNpdmU6IFtcbiAgICAgICAge1xuICAgICAgICAgIGJyZWFrcG9pbnQ6IDEwMjMsXG4gICAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgIHNsaWRlc1RvU2hvdzogMyxcbiAgICAgICAgICAgIHNsaWRlc1RvU2Nyb2xsOiAxLFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGJyZWFrcG9pbnQ6IDc2NyxcbiAgICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgc2xpZGVzVG9TaG93OiAyLFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGJyZWFrcG9pbnQ6IDQ4MCxcbiAgICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgc2xpZGVzVG9TaG93OiAxLFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgXVxuICAgIH0pO1xuXG4gICAgJCgnI3Byb2R1Y3RfX3BhbmVsMiwgI3Byb2R1Y3RfX3BhbmVsMScpLnNsaWNrKHtcbiAgICAgIGRvdHM6IGZhbHNlLFxuICAgICAgc2xpZGVzVG9TaG93OiA0LFxuICAgICAgc2xpZGVzVG9TY3JvbGw6IDEsXG4gICAgICByZXNwb25zaXZlOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBicmVha3BvaW50OiAxMDIzLFxuICAgICAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgICAgICBzbGlkZXNUb1Nob3c6IDMsXG4gICAgICAgICAgICBzbGlkZXNUb1Njcm9sbDogMSxcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBicmVha3BvaW50OiA3NjcsXG4gICAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgIHNsaWRlc1RvU2hvdzogMixcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBicmVha3BvaW50OiA0ODAsXG4gICAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgIHNsaWRlc1RvU2hvdzogMSxcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9KTtcblxuICAgIC8vdG91Y2gtZXZlbnRzIGZvciBzbGlkZXJcbiAgICAkKCcudWktc2xpZGVyLWhhbmRsZSAnKS5kcmFnZ2FibGUoKTtcblxuICAgIC8v0JjQvdC40YbQuNCw0LvQuNC30LDRhtC40Y8g0YHQu9Cw0LnQtNC10YDQsFxuICAgIGZ1bmN0aW9uIHVpU2xpZGVyKCkge1xuICAgICAgalF1ZXJ5KFwiI3NsaWRlclwiKS5zbGlkZXIoe1xuICAgICAgICBtaW46IDAsXG4gICAgICAgIG1heDogMTAwMCxcbiAgICAgICAgdmFsdWVzOiBbMCwxMDAwXSxcbiAgICAgICAgcmFuZ2U6IHRydWUsXG4gICAgICAgIHN0b3A6IGZ1bmN0aW9uKGV2ZW50LCB1aSkge1xuICAgICAgICAgIGpRdWVyeShcImlucHV0I21pbkNvc3RcIikudmFsKGpRdWVyeShcIiNzbGlkZXJcIikuc2xpZGVyKFwidmFsdWVzXCIsMCkpO1xuICAgICAgICAgIGpRdWVyeShcImlucHV0I21heENvc3RcIikudmFsKGpRdWVyeShcIiNzbGlkZXJcIikuc2xpZGVyKFwidmFsdWVzXCIsMSkpO1xuICAgICAgICAgIFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2xpZGU6IGZ1bmN0aW9uKGV2ZW50LCB1aSl7XG4gICAgICAgICAgalF1ZXJ5KFwiaW5wdXQjbWluQ29zdFwiKS52YWwoalF1ZXJ5KFwiI3NsaWRlclwiKS5zbGlkZXIoXCJ2YWx1ZXNcIiwwKSk7XG4gICAgICAgICAgalF1ZXJ5KFwiaW5wdXQjbWF4Q29zdFwiKS52YWwoalF1ZXJ5KFwiI3NsaWRlclwiKS5zbGlkZXIoXCJ2YWx1ZXNcIiwxKSk7XG4gICAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGpRdWVyeShcImlucHV0I21pbkNvc3RcIikuY2hhbmdlKGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciB2YWx1ZTE9alF1ZXJ5KFwiaW5wdXQjbWluQ29zdFwiKS52YWwoKTtcbiAgICAgICAgdmFyIHZhbHVlMj1qUXVlcnkoXCJpbnB1dCNtYXhDb3N0XCIpLnZhbCgpO1xuICAgICAgICAgIGlmKHBhcnNlSW50KHZhbHVlMSkgPiBwYXJzZUludCh2YWx1ZTIpKXtcbiAgICAgICAgICB2YWx1ZTEgPSB2YWx1ZTI7XG4gICAgICAgICAgalF1ZXJ5KFwiaW5wdXQjbWluQ29zdFwiKS52YWwodmFsdWUxKTtcbiAgICAgICAgfVxuICAgICAgICBqUXVlcnkoXCIjc2xpZGVyXCIpLnNsaWRlcihcInZhbHVlc1wiLDAsdmFsdWUxKTtcdFxuICAgICAgfSk7XG5cbiAgICAgICAgXG4gICAgICBqUXVlcnkoXCJpbnB1dCNtYXhDb3N0XCIpLmNoYW5nZShmdW5jdGlvbigpe1xuICAgICAgICAgIFxuICAgICAgICB2YXIgdmFsdWUxPWpRdWVyeShcImlucHV0I21pbkNvc3RcIikudmFsKCk7XG4gICAgICAgIHZhciB2YWx1ZTI9alF1ZXJ5KFwiaW5wdXQjbWF4Q29zdFwiKS52YWwoKTtcblxuICAgICAgICBpZihwYXJzZUludCh2YWx1ZTEpID4gcGFyc2VJbnQodmFsdWUyKSl7XG4gICAgICAgICAgdmFsdWUyID0gdmFsdWUxO1xuICAgICAgICAgIGpRdWVyeShcImlucHV0I21heENvc3RcIikudmFsKHZhbHVlMik7XG4gICAgICAgIH1cbiAgICAgICAgalF1ZXJ5KFwiI3NsaWRlclwiKS5zbGlkZXIoXCJ2YWx1ZXNcIiwxLHZhbHVlMik7XG4gICAgICB9KTtcblxuICAgICAgLy8g0YTQuNC70YzRgtGA0LDRhtC40Y8g0LLQstC+0LTQsCDQsiDQv9C+0LvRj1xuICAgICAgalF1ZXJ5KCdpbnB1dCcpLmtleXByZXNzKGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgICAgdmFyIGtleSwga2V5Q2hhcjtcbiAgICAgICAgaWYoIWV2ZW50KSB2YXIgZXZlbnQgPSB3aW5kb3cuZXZlbnQ7XG4gICAgICAgIGlmIChldmVudC5rZXlDb2RlKSBrZXkgPSBldmVudC5rZXlDb2RlO1xuICAgICAgICBlbHNlIGlmKGV2ZW50LndoaWNoKSBrZXkgPSBldmVudC53aGljaDtcbiAgICAgICAgaWYoa2V5PT1udWxsIHx8IGtleT09MCB8fCBrZXk9PTggfHwga2V5PT0xMyB8fCBrZXk9PTkgfHwga2V5PT00NiB8fCBrZXk9PTM3IHx8IGtleT09MzkgKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAga2V5Q2hhcj1TdHJpbmcuZnJvbUNoYXJDb2RlKGtleSk7IFxuICAgICAgICBpZighL1xcZC8udGVzdChrZXlDaGFyKSlcdHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdWlTbGlkZXIoKTtcblxuICAgIC8v0KDQsNGB0LrRgNGL0YLQuNC1INCy0YLQvtGA0L7Qs9C+INGD0YDQvtCy0L3RjyDQvNC10L3RjiDQsiDRgdCw0LnQtNCx0LDRgNC1XG4gICAgJCgnLmxlZnRNZW51ID4gdWwgPiBsaSA+IGEnKS5vbignY2xpY2snLCAnc3BhbicsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKS5jbG9zZXN0KCdhJykubmV4dCgndWwnKS5zbGlkZVRvZ2dsZShzcGVlZCk7XG4gICAgfSk7XG5cbiAgICAvL9Cg0LDRgdC60YDRi9GC0LjQtSDRgtC10LvQsCDQvtC00L3QvtC5INC60LDRgtC10LPQvtGA0LjQuCDRhNC40LvRjNGC0YDQsFxuICAgICQoJy5maWx0ZXJfX25hbWUnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ25vLWFjdGl2ZScpLm5leHQoJy5maWx0ZXJfX2JvZHknKS5zbGlkZVRvZ2dsZShzcGVlZCk7XG4gICAgfSk7XG5cbiAgICAvL9Ch0LrRgNGL0LLQsNC10Lwg0YfQsNGB0YLRjCDRhNC40LvRjNGC0YDQvtCyINC/0YDQuCDQt9Cw0LPRgNGD0LfQutC1XG4gICAgZnVuY3Rpb24gZmlsdGVySXRlbUhpZGRlbigpIHtcbiAgICAgIHZhciBjb3VudCA9IDI7XG4gICAgICAkKCcuZmlsdGVyJykuZmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYoJCh0aGlzKS5maW5kKCcuZmlsdGVyX19pdGVtJykubGVuZ3RoID4gY291bnQpIHtcbiAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5maWx0ZXJfX2l0ZW0nKS5lcShjb3VudCAtIDEpLm5leHRBbGwoKS5maW5kKCcuZmlsdGVyX19uYW1lJykuYWRkQ2xhc3MoJ25vLWFjdGl2ZScpLm5leHQoJy5maWx0ZXJfX2JvZHknKS5jc3MoeydkaXNwbGF5Jzonbm9uZSd9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICBmaWx0ZXJJdGVtSGlkZGVuKClcblxuICAgIC8v0KDQsNC30LLQvtGA0LDRh9C40LLQsNC90LjQtSDQuNC90L/Rg9GC0L7QsiDQsiDRhNC40LvRjNGC0YDQtVxuICAgIGZ1bmN0aW9uIGZpbHRlckNvbXBhbnkoKSB7XG4gICAgICB2YXIgY291bnQgPSAzLFxuICAgICAgICAgIHNlbGVjdG9yID0gJzxkaXYgY2xhc3M9XCJjb21wYW55X193cmFwXCIgLz4nLFxuICAgICAgICAgIHN3aXRjaFNlbCA9ICQoJy5maWx0ZXJfX3RvZ2dsZScpLFxuICAgICAgICAgIHN3aXRjaFNlbFRleHQgPSBzd2l0Y2hTZWwudGV4dCgpLFxuICAgICAgICAgIHN3aXRjaFNlbE5ld1RleHQgPSAnLSDQodCy0LXRgNC90YPRgtGMJztcbiAgICAgICQoJy5maWx0ZXJfX2NvbXBhbnknKS5maW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICBpZigkKHRoaXMpLmZpbmQoJy5maWx0ZXJfX2NvbXBhbnktLWl0ZW0nKS5sZW5ndGggPiBjb3VudCkge1xuICAgICAgICAgICQodGhpcykuZmluZCgnLmZpbHRlcl9fY29tcGFueS0taXRlbScpLmVxKGNvdW50IC0gMSkubmV4dEFsbCgpLndyYXBBbGwoc2VsZWN0b3IpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHN3aXRjaFNlbC5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJCgnLmNvbXBhbnlfX3dyYXAnKS5zbGlkZVRvZ2dsZShzcGVlZCk7XG4gICAgICAgIGlmKCQodGhpcykudGV4dCgpID09IHN3aXRjaFNlbE5ld1RleHQpIHtcbiAgICAgICAgICAkKHRoaXMpLnRleHQoc3dpdGNoU2VsVGV4dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJCh0aGlzKS50ZXh0KHN3aXRjaFNlbE5ld1RleHQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgZmlsdGVyQ29tcGFueSgpO1xuXG4gICAgJCgnLmZpbHRlcl9fc3dpdGNoJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAkKHRoaXMpLm5leHQoJy5maWx0ZXInKS5zbGlkZVRvZ2dsZShzcGVlZCk7XG4gICAgfSk7XG5cbiAgICAkKCcuaW5mb19fY2F0ZWdvcnktLWl0ZW0nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICQodGhpcykuY2xvc2VzdCgnLmluZm9fX2NhdGVnb3J5JykuZmluZCgnLm1haW5CdXR0b25zJykucmVtb3ZlQ2xhc3MoJ21haW5CdXR0b25zJyk7XG4gICAgICAkKHRoaXMpLmFkZENsYXNzKCdtYWluQnV0dG9ucycpO1xuICAgIH0pO1xuXG4gIH0pO1xuXG59KCkpOyJdfQ==
